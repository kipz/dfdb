
Running tests in #{"perf"}

Testing dfdb.joins-aggregates-performance-test

 ======================================================================
Self-Join: Mutual friendship detection
======================================================================
Loading initial data...
Creating subscription...
Compilation time: 37.44ms

Running subscription updates...
Running naive query re-executions...

--- Results ---
Subscription avg: 2.22ms
Naive avg: 3.97ms
Speedup: 1.8x
Results match: true

 ======================================================================
3-Way Join: Friend³
======================================================================
Loading initial data...
Creating subscription...
Compilation time: 16.56ms

Running subscription updates...
Running naive query re-executions...

--- Results ---
Subscription avg: 1.02ms
Naive avg: 4.38ms
Speedup: 4.3x
Results match: true

 ======================================================================
Complex Aggregate: Count, Sum, Avg by type
======================================================================
Loading initial data...
Creating subscription...
Compilation time: 62.99ms

Running subscription updates...
Running naive query re-executions...

--- Results ---
Subscription avg: 23.30ms
Naive avg: 15.08ms
Speedup: 0.6x
Results match: true

FAIL in (test-complex-aggregation) (joins_aggregates_performance_test.clj:354)
Complex Aggregation: Multiple aggregates with grouping
expected: (> (:speedup result) 1.0)
  actual: (not (> 377095823/582568249 1.0))

 ======================================================================
Hierarchical: 3-level management chain
======================================================================
Loading initial data...
Creating subscription...
Compilation time: 4.76ms

Running subscription updates...
Running naive query re-executions...

--- Results ---
Subscription avg: 1.18ms
Naive avg: 1.35ms
Speedup: 1.1x
Results match: true

FAIL in (test-manager-chain) (joins_aggregates_performance_test.clj:339)
Hierarchical Join: Employee → Manager → Skip-Level
expected: (> (:speedup result) 1.5)
  actual: (not (> 67450830/58783709 1.5))

 ======================================================================
Join + Aggregate: Sum by account type
======================================================================
Loading initial data...
Creating subscription...
Compilation time: 42.41ms

Running subscription updates...
Running naive query re-executions...

--- Results ---
Subscription avg: 12.83ms
Naive avg: 11.06ms
Speedup: 0.9x
Results match: true

FAIL in (test-join-plus-aggregate) (joins_aggregates_performance_test.clj:306)
Join + Aggregate: Total amount by account type
expected: (> (:speedup result) 1.5)
  actual: (not (> 221203833/256597892 1.5))

 ======================================================================
Triangle Join: A→B, B→C, A→C
======================================================================
Loading initial data...
Creating subscription...
Compilation time: 9.97ms

Running subscription updates...
Running naive query re-executions...

--- Results ---
Subscription avg: 0.94ms
Naive avg: 4.66ms
Speedup: 4.9x
Results match: true

 ======================================================================
Aggregation: Count transactions by type
======================================================================
Loading initial data...
Creating subscription...
Compilation time: 5.61ms

Running subscription updates...
Running naive query re-executions...

--- Results ---
Subscription avg: 6.67ms
Naive avg: 1.84ms
Speedup: 0.3x
Results match: true

 ======================================================================
Star Schema: 4-way join on users
======================================================================
Loading initial data...
Creating subscription...
Compilation time: 25.43ms

Running subscription updates...
Running naive query re-executions...

--- Results ---
Subscription avg: 5.07ms
Naive avg: 8.69ms
Speedup: 1.7x
Results match: true

 ======================================================================
Filtered Aggregate: Sum of high-value by type
======================================================================
Loading initial data...
Creating subscription...
Compilation time: 26.43ms

Running subscription updates...
Running naive query re-executions...

--- Results ---
Subscription avg: 15.91ms
Naive avg: 8.27ms
Speedup: 0.5x
Results match: true

 ======================================================================
4-Way Join: Friend⁴
======================================================================
Loading initial data...
Creating subscription...
Compilation time: 16.02ms

Running subscription updates...
Running naive query re-executions...

--- Results ---
Subscription avg: 0.65ms
Naive avg: 5.26ms
Speedup: 8.1x
Results match: true

 ======================================================================
Multi-Join Aggregate: Orders by city + status
======================================================================
Loading initial data...
Creating subscription...
Compilation time: 169.66ms

Running subscription updates...
Running naive query re-executions...

--- Results ---
Subscription avg: 18.00ms
Naive avg: 32.60ms
Speedup: 1.8x
Results match: true

FAIL in (test-multi-join-aggregate) (joins_aggregates_performance_test.clj:324)
Multi-Join + Aggregate: Orders by city and status
expected: (> (:speedup result) 2.0)
  actual: (not (> 3260490413/1799823754 2.0))

Testing dfdb.performance-smoke-test

Testing dfdb.performance-test

 ================================================================================
Scenario: High-Churn - Active Sessions
Scale: 500 users, 2000 sessions
Updates: 200
================================================================================

Setting up initial data...
Initial data loaded
Initial memory usage: 1898.61 MB

Warming up JVM...

--- Subscription Setup ---
Compilation time: 26.70 ms
Subscription active. Initial results delivered.
Initial result count: 0

--- Generating Updates ---
Generated 200 update batches

--- Subscription Benchmark ---
Completed 200 updates via subscription
Stats: mean: 11.48ms, p50: 11.07ms, p95: 13.68ms, p99: 23.79ms, min: 10.20ms, max: 28.34ms
Total time: 2296.14 ms
Throughput: 87.10 updates/sec
Memory delta: -1830.82 MB

--- Naive Query Benchmark ---
Completed 200 updates with naive queries
Stats: mean: 8.33ms, p50: 8.12ms, p95: 9.82ms, p99: 12.10ms, min: 7.49ms, max: 14.44ms
Total time: 1665.95 ms
Throughput: 120.05 updates/sec
Memory delta: 1109.81 MB

--- Results Validation ---
Subscription final result count: 0
Naive query final result count: 0
Results match: true

--- Summary ---
Speedup: 0.7x
Subscription avg latency: 11.48 ms
Naive query avg latency: 8.33 ms

FAIL in (scenario-4-high-churn-sessions) (performance_test.clj:444)
High-Churn: Active User Sessions
Subscriptions should be faster for high-churn workloads
expected: (> (:speedup results) 1.0)
  actual: (not (> 0.7255412457118829 1.0))

 ================================================================================
Scenario: Micro Updates (1-5 datoms)
Scale: 1000 products, micro updates
Updates: 50
================================================================================

Setting up initial data...
Initial data loaded
Initial memory usage: 2310.60 MB

Warming up JVM...

--- Subscription Setup ---
Compilation time: 6.10 ms
Subscription active. Initial results delivered.
Initial result count: 203

--- Generating Updates ---
Generated 50 update batches

--- Subscription Benchmark ---
Completed 50 updates via subscription
Stats: mean: 4.18ms, p50: 4.11ms, p95: 4.58ms, p99: 5.86ms, min: 3.87ms, max: 5.86ms
Total time: 209.00 ms
Throughput: 239.24 updates/sec
Memory delta: -2151.83 MB

--- Naive Query Benchmark ---
Completed 50 updates with naive queries
Stats: mean: 2.83ms, p50: 2.80ms, p95: 3.06ms, p99: 3.31ms, min: 2.64ms, max: 3.31ms
Total time: 141.30 ms
Throughput: 353.86 updates/sec
Memory delta: 605.00 MB

--- Results Validation ---
Subscription final result count: 201
Naive query final result count: 201
Results match: true

--- Summary ---
Speedup: 0.7x
Subscription avg latency: 4.18 ms
Naive query avg latency: 2.83 ms

 ================================================================================
Scenario: Social Network - Large Scale
Scale: 5000 users, avg 20 friends
Updates: 100
================================================================================

Setting up initial data...
Initial data loaded
Initial memory usage: 1508.91 MB

Warming up JVM...

--- Subscription Setup ---
Compilation time: 6322.67 ms
Subscription active. Initial results delivered.
Initial result count: 5000

--- Generating Updates ---
Generated 100 update batches

--- Subscription Benchmark ---
Completed 100 updates via subscription
Stats: mean: 226.49ms, p50: 217.46ms, p95: 315.96ms, p99: 342.45ms, min: 207.84ms, max: 342.45ms
Total time: 22648.68 ms
Throughput: 4.42 updates/sec
Memory delta: 272.86 MB

--- Naive Query Benchmark ---
Completed 100 updates with naive queries
Stats: mean: 3186.58ms, p50: 3050.20ms, p95: 4058.05ms, p99: 4938.15ms, min: 2607.24ms, max: 4938.15ms
Total time: 318658.29 ms
Throughput: 0.31 updates/sec
Memory delta: -745.60 MB

--- Results Validation ---
Subscription final result count: 5000
Naive query final result count: 5000
Results match: true

--- Summary ---
Speedup: 14.1x
Subscription avg latency: 226.49 ms
Naive query avg latency: 3186.58 ms

 ================================================================================
Scenario: Social Network - Friend Recommendations
Scale: 500 users, avg 8 friends
Updates: 50
================================================================================

Setting up initial data...
Initial data loaded
Initial memory usage: 1823.00 MB

Warming up JVM...

--- Subscription Setup ---
Compilation time: 134.38 ms
Subscription active. Initial results delivered.
Initial result count: 496

--- Generating Updates ---
Generated 50 update batches

--- Subscription Benchmark ---
Completed 50 updates via subscription
Stats: mean: 12.40ms, p50: 11.83ms, p95: 15.07ms, p99: 40.10ms, min: 9.23ms, max: 40.10ms
Total time: 619.80 ms
Throughput: 80.67 updates/sec
Memory delta: -897.00 MB

--- Naive Query Benchmark ---
Completed 50 updates with naive queries
Stats: mean: 56.55ms, p50: 50.93ms, p95: 90.56ms, p99: 113.72ms, min: 44.90ms, max: 113.72ms
Total time: 2827.47 ms
Throughput: 17.68 updates/sec
Memory delta: 582.00 MB

--- Results Validation ---
Subscription final result count: 498
Naive query final result count: 498
Results match: true

--- Summary ---
Speedup: 4.6x
Subscription avg latency: 12.40 ms
Naive query avg latency: 56.55 ms

 ================================================================================
Scenario: E-commerce - Low Price In-Stock Products
Scale: 5000 products
Updates: 100
================================================================================

Setting up initial data...
Initial data loaded
Initial memory usage: 2023.80 MB

Warming up JVM...

--- Subscription Setup ---
Compilation time: 157.86 ms
Subscription active. Initial results delivered.
Initial result count: 974

--- Generating Updates ---
Generated 100 update batches

--- Subscription Benchmark ---
Completed 100 updates via subscription
Stats: mean: 22.99ms, p50: 21.23ms, p95: 41.45ms, p99: 46.22ms, min: 19.58ms, max: 46.22ms
Total time: 2299.03 ms
Throughput: 43.50 updates/sec
Memory delta: -1891.79 MB

--- Naive Query Benchmark ---
Completed 100 updates with naive queries
Stats: mean: 38.22ms, p50: 35.31ms, p95: 51.61ms, p99: 59.07ms, min: 32.62ms, max: 59.07ms
Total time: 3822.26 ms
Throughput: 26.16 updates/sec
Memory delta: 247.20 MB

--- Results Validation ---
Subscription final result count: 978
Naive query final result count: 978
Results match: true

--- Summary ---
Speedup: 1.7x
Subscription avg latency: 22.99 ms
Naive query avg latency: 38.22 ms

 ================================================================================
Scenario: Bulk Updates (50-100 datoms)
Scale: 1000 products, bulk updates
Updates: 20
================================================================================

Setting up initial data...
Initial data loaded
Initial memory usage: 1105.08 MB

Warming up JVM...

--- Subscription Setup ---
Compilation time: 5.81 ms
Subscription active. Initial results delivered.
Initial result count: 200

--- Generating Updates ---
Generated 20 update batches

--- Subscription Benchmark ---
Completed 20 updates via subscription
Stats: mean: 135.73ms, p50: 125.00ms, p95: 211.90ms, p99: 211.90ms, min: 82.32ms, max: 211.90ms
Total time: 2714.55 ms
Throughput: 7.37 updates/sec
Memory delta: 1161.92 MB

--- Naive Query Benchmark ---
Completed 20 updates with naive queries
Stats: mean: 3.93ms, p50: 4.06ms, p95: 4.77ms, p99: 4.77ms, min: 2.95ms, max: 4.77ms
Total time: 78.62 ms
Throughput: 254.39 updates/sec
Memory delta: -1248.65 MB

--- Results Validation ---
Subscription final result count: 222
Naive query final result count: 222
Results match: true

--- Summary ---
Speedup: 0.0x
Subscription avg latency: 135.73 ms
Naive query avg latency: 3.93 ms

 ================================================================================
Scenario: Analytics - Sales by Category
Scale: 1000 products, 5000 initial orders
Updates: 50
================================================================================

Setting up initial data...
Initial data loaded
Initial memory usage: 2544.17 MB

Warming up JVM...

--- Subscription Setup ---
Compilation time: 155.44 ms
Subscription active. Initial results delivered.
Initial result count: 5

--- Generating Updates ---
Generated 50 update batches

--- Subscription Benchmark ---
Completed 50 updates via subscription
Stats: mean: 28.69ms, p50: 26.53ms, p95: 29.73ms, p99: 85.00ms, min: 25.62ms, max: 85.00ms
Total time: 1434.52 ms
Throughput: 34.85 updates/sec
Memory delta: 1908.00 MB

--- Naive Query Benchmark ---
Completed 50 updates with naive queries
Stats: mean: 51.54ms, p50: 48.37ms, p95: 66.88ms, p99: 67.74ms, min: 45.20ms, max: 67.74ms
Total time: 2577.24 ms
Throughput: 19.40 updates/sec
Memory delta: 1212.98 MB

--- Results Validation ---
Subscription final result count: 5
Naive query final result count: 5
Results match: true

--- Summary ---
Speedup: 1.8x
Subscription avg latency: 28.69 ms
Naive query avg latency: 51.54 ms

 ================================================================================
Scenario: Social Network - Small Scale
Scale: 100 users, avg 5 friends
Updates: 50
================================================================================

Setting up initial data...
Initial data loaded
Initial memory usage: 161.88 MB

Warming up JVM...

--- Subscription Setup ---
Compilation time: 11.02 ms
Subscription active. Initial results delivered.
Initial result count: 95

--- Generating Updates ---
Generated 50 update batches

--- Subscription Benchmark ---
Completed 50 updates via subscription
Stats: mean: 1.61ms, p50: 1.64ms, p95: 1.87ms, p99: 1.95ms, min: 1.28ms, max: 1.95ms
Total time: 80.58 ms
Throughput: 620.48 updates/sec
Memory delta: 386.43 MB

--- Naive Query Benchmark ---
Completed 50 updates with naive queries
Stats: mean: 4.24ms, p50: 4.30ms, p95: 5.24ms, p99: 5.58ms, min: 3.20ms, max: 5.58ms
Total time: 211.82 ms
Throughput: 236.05 updates/sec
Memory delta: 711.00 MB

--- Results Validation ---
Subscription final result count: 98
Naive query final result count: 98
Results match: true

--- Summary ---
Speedup: 2.6x
Subscription avg latency: 1.61 ms
Naive query avg latency: 4.24 ms

Ran 22 tests containing 35 assertions.
5 failures, 0 errors.
Execution error (ExceptionInfo) at cognitect.test-runner.api/test (api.clj:30).
Test failures or errors occurred.

Full report at:
/var/folders/34/gnyxj28j4t9cyq61bzdz2b9w0000gp/T/clojure-2574461694001322923.edn
